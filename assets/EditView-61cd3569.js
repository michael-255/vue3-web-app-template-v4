import{d as R,u as V,A as k,a as C,D as g,r as I,H as $,a9 as x,b,o as A,c as r,e as y,w as c,h as t,j as d,f as s,Q as B,m as h,I as l,i as Q,F,k as M,l as n,n as N,a6 as T,a7 as U,ac as q,aa as j,ad as L}from"./index-dac8af9a.js";import{Q as W}from"./QForm-a526fa18.js";import{_ as z}from"./ResponsivePage.vue_vue_type_script_setup_true_lang-1fde7320.js";import{_ as H}from"./ParentInfoCard.vue_vue_type_script_setup_true_lang-90c077e5.js";import{u as O}from"./useRoutables-b3d27bb8.js";import{u as G}from"./action-ce75db83.js";import{u as J}from"./useDialogs-e0ea9c25.js";import"./SimpleDialog.vue_vue_type_script_setup_true_lang-a0d57a44.js";const K={key:0},X=n("span",{class:"q-ml-md"},"Error rendering this record",-1),Y={key:1},Z={class:"row justify-start"},P={class:"col"},ee={class:"col"},ae=n("span",{class:"text-caption q-ml-xs text-warning"}," Correct invalid entries and try again ",-1),ue=R({__name:"EditView",setup(te){V({title:`${k} - Edit Record`});const{routeType:i,routeId:u,goBack:w}=O(),{log:m}=C(),{confirmDialog:D}=J(),f=G(),p=g.getLabelSingular(i),v=g.getFieldProps(i),_=I(!0);$(async()=>{try{if(await x.isValid(u)){const e=await b.getRecord(i,u);e&&Object.keys(e).forEach(o=>{f.record[o]=e[o]})}}catch(e){m.error("Error loading edit view",e)}}),A(()=>{f.$reset()});async function E(){D("Update",`Update ${p} record?`,l.CREATE,"positive",async()=>{try{const e=q(!0,{},f.record);await b.updateRecord(i,u,e),m.info("Successfully updated record",{id:e[j.ID],type:i}),w()}catch(e){m.error("Update failed",e)}})}return(e,o)=>(r(),y(z,{bannerIcon:t(l).EDIT,bannerTitle:`Edit ${t(p)}`},{default:c(()=>[!t(p)||!t(v)?(r(),d("div",K,[s(Q,{class:"q-mb-md"},{default:c(()=>[s(B,null,{default:c(()=>[s(h,{name:t(l).WARN,size:"md",color:"warning"},null,8,["name"]),X]),_:1})]),_:1})])):(r(),d("div",Y,[s(W,{onSubmit:E,onValidationError:o[0]||(o[0]=a=>_.value=!1),onValidationSuccess:o[1]||(o[1]=a=>_.value=!0)},{default:c(()=>[s(H),(r(!0),d(F,null,M(t(v),(a,S)=>(r(),d("div",{key:S,class:"q-mb-md"},[(r(),y(L(a.component),{field:a.field,label:a.label,desc:a.desc,getDefault:a.getDefault,validator:a.validator,validationMessage:a.validationMessage},null,8,["field","label","desc","getDefault","validator","validationMessage"]))]))),128)),n("div",Z,[n("div",P,[s(N,{label:"Update",type:"submit",color:"positive",icon:t(l).SAVE},null,8,["icon"])]),n("div",ee,[T(n("div",null,[s(h,{name:t(l).WARN,color:"warning"},null,8,["name"]),ae],512),[[U,!_.value]])])])]),_:1})]))]),_:1},8,["bannerIcon","bannerTitle"]))}});export{ue as default};
