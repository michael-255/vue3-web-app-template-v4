import{Q as k,a as x,b as E,c as G}from"./QTable-b3965f2a.js";import{q as j,N as M,G as z,t as H,r as p,O as h,W as S,a0 as f,D as T,x as J,y as b,z as V,A as t,B as s,S as q,T as Q,U as $,_ as C,J as d,u as e,I as u,E as y,F as w,Q as L,a1 as W,V as Y,Y as Z,Z as K,a3 as X}from"./index-5cff7ac3.js";import{Q as ee}from"./QSelect-b0d74de1.js";import{u as le}from"./useRoutables-30265fa0.js";import{u as oe}from"./useDialogs-b7894612.js";import"./QList-30b88ef1.js";import"./QItem-7dd31eaa.js";import"./QItemLabel-6b954a86.js";import"./QMenu-e96979e1.js";import"./selection-2bdc6de2.js";const ae={class:"row justify-start full-width q-mb-md"},se={class:"col-10 text-h6 text-bold ellipsis"},te={class:"row justify-start full-width"},ne={class:"col-12"},he=j({__name:"DataRecordsView",setup(re){M({title:`${z} - Records Data`});const{log:g}=H(),{routeGroup:i,routeType:r,goToCharts:B,goToEdit:I,goToCreate:N,goBack:R}=le(),{confirmDialog:A,inspectDialog:O}=oe(),D=p(""),c=p([]),m=p([]),_=p(h.getTableColumns(i,r)),F=p(_.value.filter(o=>!o.required));let v=null;i===S.Values.core?(m.value=[f.Values.id,f.Values.timestamp,f.Values.name],v=T.liveCoreRecords(r).subscribe({next:o=>{c.value=o},error:o=>{g.error("Error fetching live parent data",o)}})):(m.value=[f.Values.id,f.Values.timestamp],v=T.liveSubRecords(r).subscribe({next:o=>{c.value=o},error:o=>{g.error("Error fetching live child data",o)}})),J(()=>{v==null||v.unsubscribe()});async function P(o,a){let l="";o===S.Values.core?l=`Permanently delete ${h.getLabel(i,r,"singular")} with id ${a}? This will also delete associated sub-records.`:l=`Permanently delete ${h.getLabel(i,r,"singular")} with id ${a}?`,A("Delete",l,u.DELETE,"negative",async()=>{try{await T.deleteRecord(o,a),g.info("Successfully deleted record",{type:r,id:a})}catch(n){g.error("Delete failed",n)}})}async function U(o){O("Log",{id:o})}return(o,a)=>(b(),V(G,{rows:c.value,columns:_.value,"visible-columns":m.value,"rows-per-page-options":[0],filter:D.value,"virtual-scroll":"",fullscreen:"","row-key":"id"},{header:t(l=>[s(x,{props:l},{default:t(()=>[(b(!0),q($,null,Q(l.cols,n=>Z((b(),V(k,{key:n.name,props:l},{default:t(()=>[C(w(n.label),1)]),_:2},1032,["props"])),[[K,!e(X).includes(n.name)]])),128)),s(k,{"auto-width":"",class:"text-left"},{default:t(()=>[C("Actions")]),_:1})]),_:2},1032,["props"])]),body:t(l=>[s(x,{props:l},{default:t(()=>[(b(!0),q($,null,Q(l.cols,n=>(b(),V(E,{key:n.name,props:l},{default:t(()=>[C(w(n.value),1)]),_:2},1032,["props"]))),128)),s(E,{"auto-width":""},{default:t(()=>[s(d,{flat:"",round:"",dense:"",class:"q-ml-xs",color:"accent",icon:e(u).CHARTS,onClick:n=>e(B)(e(r),l.cols[0].value)},null,8,["icon","onClick"]),s(d,{flat:"",round:"",dense:"",class:"q-ml-xs",color:"primary",icon:e(u).INSPECT,onClick:n=>U(l.cols[0].value)},null,8,["icon","onClick"]),s(d,{flat:"",round:"",dense:"",class:"q-ml-xs",color:"orange-9",icon:e(u).EDIT,onClick:n=>e(I)(e(i),e(r),l.cols[0].value)},null,8,["icon","onClick"]),s(d,{flat:"",round:"",dense:"",class:"q-ml-xs",color:"negative",onClick:n=>P(e(i),l.cols[0].value),icon:e(u).DELETE},null,8,["onClick","icon"])]),_:2},1024)]),_:2},1032,["props"])]),top:t(()=>[y("div",ae,[y("div",se,w(e(h).getLabel(e(i),e(r),"plural")),1),s(d,{round:"",flat:"",class:"absolute-top-right q-mr-sm q-mt-sm",icon:e(u).CLOSE,onClick:a[0]||(a[0]=l=>e(R)())},null,8,["icon"])]),y("div",te,[y("div",ne,[s(W,{disable:!c.value.length,outlined:"",dense:"",clearable:"",debounce:"300",modelValue:D.value,"onUpdate:modelValue":a[3]||(a[3]=l=>D.value=l),placeholder:"Search"},{before:t(()=>[s(d,{color:"positive",class:"q-px-sm q-mr-xs",icon:e(u).ADD,onClick:a[1]||(a[1]=l=>e(N)(e(i),e(r)))},null,8,["icon"]),s(ee,{modelValue:m.value,"onUpdate:modelValue":a[2]||(a[2]=l=>m.value=l),options:F.value,disable:!c.value.length,"bg-color":"primary",standout:"",multiple:"",dense:"","options-dense":"","emit-value":"","map-options":"","option-value":"name","display-value":""},{prepend:t(()=>[s(L,{color:"white",name:e(u).OPTIONS},null,8,["name"])]),_:1},8,["modelValue","options","disable"])]),append:t(()=>[s(L,{name:"search"})]),_:1},8,["disable","modelValue"])])])]),bottom:t(()=>[C(w(e(Y)(c.value)),1)]),_:1},8,["rows","columns","visible-columns","filter"]))}});export{he as default};
