import{Q as k,a as _,b as x,c as F}from"./QTable-6cf60de9.js";import{k as U,U as M,A as j,F as H,r as m,D as p,Y as z,m as c,n as f,w as a,p as s,G as E,M as S,L as V,K as g,x as o,V as Q,z as u,I as i,O as G,t as b,v as h,Q as q,_ as J,N as K,H as X,J as Y}from"./index-f3361964.js";import{Q as W}from"./QSelect-a19f45ba.js";import{u as Z}from"./useRouting-895183c5.js";import{u as ee}from"./useDialogs-fd03caa6.js";import"./QList-a4c30b06.js";import"./QItem-8b14278c.js";import"./QItemLabel-d7dfbf01.js";import"./QMenu-280a0528.js";import"./selection-5f67755e.js";import"./action-e604cc81.js";import"./ErrorStates.vue_vue_type_script_setup_true_lang-5b4d89d8.js";import"./ui-405fb474.js";const oe={class:"row justify-start full-width q-mb-md"},le={class:"col-10 text-h6 text-bold ellipsis"},te={class:"row justify-start full-width"},ae={class:"col-12"},Ce=U({__name:"DataRecordsView",setup(se){M({title:`${j} - Records Data Table`});const{log:v}=H(),{routeTable:r,goToEdit:I,goToCreate:B,goBack:L}=Z(),{confirmDialog:N,inspectDialog:R,chartsDialog:$}=ee(),C=m(""),d=m([]),y=m(p.getTableColumns(r)),T=m(y.value.filter(l=>!l.required)),D=m(T.value.map(l=>l.name)),w=p.liveDataTable(r).subscribe({next:l=>d.value=l,error:l=>v.error("Error fetching live records data",l)});z(()=>{w==null||w.unsubscribe()});async function A(l,t){N("Delete","Permanently delete this record? Please note that all child records are deleted when you delete a parent record.",i.DELETE,"negative",async()=>{try{await p.deleteRecord(l,t),v.info("Successfully deleted record",{table:l,id:t})}catch(e){v.error("Delete failed",e)}})}async function O(l,t){const e=await p.getRecord(l,t);e?R(e,l):v.error("Failed to find record",{table:l,id:t})}async function P(l,t){$(t,l)}return(l,t)=>(c(),f(F,{rows:d.value,columns:y.value,"visible-columns":D.value,"rows-per-page-options":[0],filter:C.value,"virtual-scroll":"",fullscreen:"","row-key":"id"},{header:a(e=>[s(_,{props:e},{default:a(()=>[(c(!0),E(V,null,S(e.cols,n=>X((c(),f(k,{key:n.name,props:e},{default:a(()=>[g(h(n.label),1)]),_:2},1032,["props"])),[[Y,n.name!=="hiddenId"]])),128)),s(k,{"auto-width":"",class:"text-left"},{default:a(()=>[g("Actions")]),_:1})]),_:2},1032,["props"])]),body:a(e=>[s(_,{props:e},{default:a(()=>[(c(!0),E(V,null,S(e.cols,n=>(c(),f(x,{key:n.name,props:e},{default:a(()=>[g(h(n.value),1)]),_:2},1032,["props"]))),128)),s(x,{"auto-width":""},{default:a(()=>[[o(Q).EXAMPLES,o(Q).TESTS].includes(o(r))?(c(),f(u,{key:0,flat:"",round:"",dense:"",class:"q-ml-xs",color:"accent",icon:o(i).CHARTS,onClick:n=>P(o(r),e.cols[0].value)},null,8,["icon","onClick"])):G("",!0),s(u,{flat:"",round:"",dense:"",class:"q-ml-xs",color:"primary",icon:o(i).INSPECT,onClick:n=>O(o(r),e.cols[0].value)},null,8,["icon","onClick"]),s(u,{flat:"",round:"",dense:"",class:"q-ml-xs",color:"orange-9",icon:o(i).EDIT,onClick:n=>o(I)(o(r),e.cols[0].value)},null,8,["icon","onClick"]),s(u,{flat:"",round:"",dense:"",class:"q-ml-xs",color:"negative",onClick:n=>A(o(r),e.cols[0].value),icon:o(i).DELETE},null,8,["onClick","icon"])]),_:2},1024)]),_:2},1032,["props"])]),top:a(()=>[b("div",oe,[b("div",le,h(o(p).getLabel(o(r),"plural")),1),s(u,{round:"",flat:"",class:"absolute-top-right q-mr-sm q-mt-sm",icon:o(i).CLOSE,onClick:t[0]||(t[0]=e=>o(L)())},null,8,["icon"])]),b("div",te,[b("div",ae,[s(J,{disable:!d.value.length,outlined:"",dense:"",clearable:"",debounce:"300",modelValue:C.value,"onUpdate:modelValue":t[3]||(t[3]=e=>C.value=e),placeholder:"Search"},{before:a(()=>[s(u,{color:"positive",class:"q-px-sm q-mr-xs",icon:o(i).ADD,onClick:t[1]||(t[1]=e=>o(B)(o(r)))},null,8,["icon"]),s(W,{modelValue:D.value,"onUpdate:modelValue":t[2]||(t[2]=e=>D.value=e),options:T.value,disable:!d.value.length,"bg-color":"primary",standout:"",multiple:"",dense:"","options-dense":"","emit-value":"","map-options":"","option-value":"name","display-value":""},{prepend:a(()=>[s(q,{color:"white",name:o(i).OPTIONS},null,8,["name"])]),_:1},8,["modelValue","options","disable"])]),append:a(()=>[s(q,{name:"search"})]),_:1},8,["disable","modelValue"])])])]),bottom:a(()=>[g(h(o(K)(d.value)),1)]),_:1},8,["rows","columns","visible-columns","filter"]))}});export{Ce as default};
