import{q as k,N as x,G as B,t as R,O as E,r as $,ac as q,a0 as v,aq as N,D as w,x as Q,y as r,z as b,A as m,u as t,S as p,B as n,C as A,Q as D,I as c,L as T,X as F,U,T as L,E as d,J as j,Y as z,Z as G,ar as M,as as O}from"./index-ef11a4d2.js";import{_ as W,Q as J}from"./ParentInfoCard.vue_vue_type_script_setup_true_lang-002aff9b.js";import{_ as X}from"./ResponsivePage.vue_vue_type_script_setup_true_lang-17ea769c.js";import{u as Y}from"./useRoutables-81d4533e.js";import{u as Z}from"./action-ee52ff77.js";import{u as H}from"./useDialogs-c3fdb6eb.js";import"./QSelect-f9ed5694.js";import"./QItem-bdaee51e.js";import"./QItemLabel-6937233e.js";import"./QMenu-17d8d43f.js";import"./selection-0dee77d8.js";import"./ui-29eb266c.js";const K={key:0},P=d("span",{class:"q-ml-md"},"Error rendering this record",-1),ee={key:1},te={class:"row justify-center q-my-sm"},ae={class:"row justify-center"},se=d("span",{class:"text-caption q-ml-xs text-warning"}," Correct invalid entries and try again ",-1),ye=k({__name:"EditView",setup(oe){x({title:`${B} - Edit Record`});const{routeGroup:l,routeType:i,routeId:f,goBack:I}=Y(),{log:_}=R(),{confirmDialog:V}=H(),a=Z(),g=E.getLabel(l,i,"singular"),h=E.getFieldProps(l,i),y=$(!0);q(async()=>{try{if(a.record[v.Values.id]=N(),a.record[v.Values.type]=i,f){const e=await w.getRecord(l,f);e&&Object.keys(e).forEach(s=>{a.record[s]=e[s]})}}catch(e){_.error("Error loading edit view",e)}}),Q(()=>{a.$reset()});async function S(){V("Update",`Update ${g} record?`,c.EDIT,"positive",async()=>{try{const e=M(!0,{},a.record);await w.updateRecord(l,i,f,e),_.info("Successfully updated record",{id:e[v.Values.id],type:i}),I()}catch(e){_.error("Edit failed",e)}})}return(e,s)=>(r(),b(X,{bannerIcon:t(c).EDIT,bannerTitle:`Edit ${t(g)}`},{default:m(()=>[!t(g)||!t(h)?(r(),p("div",K,[n(T,{class:"q-mb-md"},{default:m(()=>[n(A,null,{default:m(()=>[n(D,{name:t(c).WARN,size:"md",color:"warning"},null,8,["name"]),P]),_:1})]),_:1})])):(r(),p("div",ee,[n(J,{onSubmit:S,onValidationError:s[0]||(s[0]=u=>y.value=!1),onValidationSuccess:s[1]||(s[1]=u=>y.value=!0)},{default:m(()=>{var u;return[(u=t(a).record)!=null&&u.coreId?(r(),b(W,{key:0,coreId:t(a).record.coreId},null,8,["coreId"])):F("",!0),(r(!0),p(U,null,L(t(h),(o,C)=>(r(),p("div",{key:C,class:"q-mb-md"},[(r(),b(O(o.component),{field:o.field,label:o.label,desc:o.desc,getDefault:o.getDefault,schema:o.schema,message:o.message},null,8,["field","label","desc","getDefault","schema","message"]))]))),128)),d("div",te,[n(j,{label:"Update",type:"submit",color:"positive",icon:t(c).SAVE},null,8,["icon"])]),d("div",ae,[z(d("div",null,[n(D,{name:t(c).WARN,color:"warning"},null,8,["name"]),se],512),[[G,!y.value]])])]}),_:1})]))]),_:1},8,["bannerIcon","bannerTitle"]))}});export{ye as default};
