import{q as k,N as x,G as B,t as I,O as b,r as R,aa as h,$ as p,ao as T,D as w,x as q,y as a,z as f,A as E,u as o,R as y,B as _,T as A,S as C,E as c,J as F,I as i,X as N,Y as Q,Q as U,ap as j,aq as L}from"./index-24dbccec.js";import{Q as G}from"./QForm-dd1a2df2.js";import{_ as M}from"./ErrorStates.vue_vue_type_script_setup_true_lang-9c0cc8d9.js";import{_ as O}from"./ResponsivePage.vue_vue_type_script_setup_true_lang-de00a452.js";import{u as z}from"./useRoutables-4d249602.js";import{u as J}from"./action-b51c5118.js";import{u as W}from"./useDialogs-81031fdf.js";import"./QSelect-1164f6a3.js";import"./QItem-4a4784b7.js";import"./QItemLabel-2ad87e79.js";import"./QMenu-315589be.js";import"./selection-f172746f.js";import"./ui-e8c912c8.js";const X={key:0},Y={class:"row justify-center q-my-sm"},H={class:"row justify-center"},K=c("span",{class:"text-caption q-ml-xs text-warning"}," Correct invalid entries and try again ",-1),me=k({__name:"EditView",setup(P){x({title:`${B} - Edit Record`});const{routeGroup:n,routeType:r,routeId:v,goBack:V}=z(),{log:d}=I(),{confirmDialog:D}=W(),s=J(),l=b.getLabel(n,r,"singular"),g=b.getFields(n,r),u=R(!0);h(async()=>{try{s.record[p.Values.id]=T(),s.record[p.Values.type]=r;const e=await w.getRecord(n,v);e&&Object.keys(e).map(t=>{s.record[t]=e[t]})}catch(e){d.error("Error loading edit view",e)}}),q(()=>{s.$reset()});async function S(){D("Update",`Update ${l} record?`,i.EDIT,"positive",async()=>{try{const e=j(!0,{},s.record);await w.updateRecord(n,r,v,e),d.info("Successfully updated record",{id:e[p.Values.id],type:r}),V()}catch(e){d.error("Edit failed",e)}})}return(e,t)=>(a(),f(O,{bannerIcon:o(i).EDIT,bannerTitle:`Edit ${o(l)}`},{default:E(()=>[o(l)&&o(g)?(a(),y("div",X,[_(G,{onSubmit:S,onValidationError:t[0]||(t[0]=m=>u.value=!1),onValidationSuccess:t[1]||(t[1]=m=>u.value=!0)},{default:E(()=>[(a(!0),y(A,null,C(o(g),(m,$)=>(a(),y("div",{key:$,class:"q-mb-md"},[(a(),f(L(m),{inspecting:!1}))]))),128)),c("div",Y,[_(F,{label:"Update",type:"submit",color:"positive",icon:o(i).SAVE},null,8,["icon"])]),c("div",H,[N(c("div",null,[_(U,{name:o(i).WARN,color:"warning"},null,8,["name"]),K],512),[[Q,!u.value]])])]),_:1})])):(a(),f(M,{key:1,error:"unknown"}))]),_:1},8,["bannerIcon","bannerTitle"]))}});export{me as default};
