import{q as k,N as x,G as B,t as R,O as E,r as $,ab as q,a0 as v,ap as N,D as w,x as Q,y as r,z as b,A as m,u as a,S as p,B as n,C as A,Q as D,I as i,L as T,X as F,U,T as L,E as d,J as j,Y as z,Z as G,aq as M,ar as O}from"./index-5cff7ac3.js";import{_ as W,Q as J}from"./ParentInfoCard.vue_vue_type_script_setup_true_lang-3328d601.js";import{_ as X}from"./ResponsivePage.vue_vue_type_script_setup_true_lang-639c5f80.js";import{u as Y}from"./useRoutables-30265fa0.js";import{u as Z}from"./action-d0cf9b67.js";import{u as H}from"./useDialogs-b7894612.js";const K={key:0},P=d("span",{class:"q-ml-md"},"Error rendering this record",-1),ee={key:1},ae={class:"row justify-center q-my-sm"},te={class:"row justify-center"},se=d("span",{class:"text-caption q-ml-xs text-warning"}," Correct invalid entries and try again ",-1),ue=k({__name:"EditView",setup(oe){x({title:`${B} - Edit Record`});const{routeGroup:l,routeType:c,routeId:f,goBack:I}=Y(),{log:_}=R(),{confirmDialog:V}=H(),t=Z(),g=E.getLabel(l,c,"singular"),h=E.getFieldProps(l,c),y=$(!0);q(async()=>{try{if(t.record[v.Values.id]=N(),t.record[v.Values.type]=c,f){const e=await w.getRecord(l,f);e&&Object.keys(e).forEach(s=>{t.record[s]=e[s]})}}catch(e){_.error("Error loading edit view",e)}}),Q(()=>{t.$reset()});async function S(){V("Update",`Update ${g} record?`,i.EDIT,"positive",async()=>{try{const e=M(!0,{},t.record);await w.updateRecord(l,c,f,e),_.info("Successfully updated record",{id:e[v.Values.id],type:c}),I()}catch(e){_.error("Edit failed",e)}})}return(e,s)=>(r(),b(X,{bannerIcon:a(i).EDIT,bannerTitle:`Edit ${a(g)}`},{default:m(()=>[!a(g)||!a(h)?(r(),p("div",K,[n(T,{class:"q-mb-md"},{default:m(()=>[n(A,null,{default:m(()=>[n(D,{name:a(i).WARN,size:"md",color:"warning"},null,8,["name"]),P]),_:1})]),_:1})])):(r(),p("div",ee,[n(J,{onSubmit:S,onValidationError:s[0]||(s[0]=u=>y.value=!1),onValidationSuccess:s[1]||(s[1]=u=>y.value=!0)},{default:m(()=>{var u;return[(u=a(t).record)!=null&&u.coreId?(r(),b(W,{key:0,coreId:a(t).record.coreId},null,8,["coreId"])):F("",!0),(r(!0),p(U,null,L(a(h),(o,C)=>(r(),p("div",{key:C,class:"q-mb-md"},[(r(),b(O(o.component),{field:o.field,label:o.label,desc:o.desc,getDefault:o.getDefault,schema:o.schema,message:o.message},null,8,["field","label","desc","getDefault","schema","message"]))]))),128)),d("div",ae,[n(j,{label:"Update",type:"submit",color:"positive",icon:a(i).SAVE},null,8,["icon"])]),d("div",te,[z(d("div",null,[n(D,{name:a(i).WARN,color:"warning"},null,8,["name"]),se],512),[[G,!y.value]])])]}),_:1})]))]),_:1},8,["bannerIcon","bannerTitle"]))}});export{ue as default};
