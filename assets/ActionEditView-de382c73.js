import{d as D,u as R,A as I,a as B,O as $,r as x,G as S,c as v,D as g,o as T,f as r,h as y,w as u,l as s,q as p,j as d,Q as k,m as C,F,s as Q,p as n,B as V,I as m,n as A,v as N,t as U,z as q,H as j,P as L,R as M}from"./index-85cdcb14.js";import{Q as O}from"./QForm-0062d92d.js";import{u as P}from"./useRoutables-c00f81b4.js";import{u as Y}from"./action-c39eed1c.js";import{u as z}from"./useDialogs-bd0c25a5.js";import{_ as G}from"./ResponsivePage.vue_vue_type_script_setup_true_lang-41aa508e.js";import"./SimpleDialog.vue_vue_type_script_setup_true_lang-7796c2c3.js";const H={key:0},W=n("div",{class:"text-h6"},"No fields available for this record type",-1),J={key:1},K={class:"row justify-start"},X={class:"col"},Z={class:"col"},ee=n("span",{class:"text-caption q-ml-xs text-warning"}," Correct invalid entries and try again ",-1),ce=D({__name:"ActionEditView",setup(te){R({title:`${I} - Edit Record`});const{routeDatabaseType:o,routeId:c,goBack:h}=P(),{log:f}=B(),{confirmDialog:E}=z(),i=Y(),b=$(o),_=x(!0);S(async()=>{try{if(i.record[v.TYPE]=o,c){const a=await g.getRecord(o,c);a&&Object.keys(a).forEach(e=>{i.record[e]=a[e]})}}catch(a){f.error("Error loading edit view",a)}}),T(()=>{i.$reset()});async function w(){const e=j(o).reduce((t,l)=>(t[l]=i.record[l],t),{});E("Update Record",`Update record ${e[v.ID]} for ${e[v.TYPE]}?`,m.EDIT,"positive",async()=>{try{const t=L(!0,{},e);await g.updateRecord(o,c,t),f.info("Successfully updated record",{updatedRecordType:o,updatedRecordId:c}),i.$reset(),h()}catch(t){f.error("Update failed",t)}})}return(a,e)=>(r(),y(G,{bannerIcon:s(m).EDIT,bannerTitle:`Edit ${s(q)(s(o),"singular")}`},{default:u(()=>[s(b).length===0?(r(),p("div",H,[d(C,{class:"q-mb-md"},{default:u(()=>[d(k,null,{default:u(()=>[W]),_:1})]),_:1})])):(r(),p("div",J,[d(O,{greedy:"",onSubmit:w,onValidationError:e[0]||(e[0]=t=>_.value=!1),onValidationSuccess:e[1]||(e[1]=t=>_.value=!0)},{default:u(()=>[(r(!0),p(F,null,Q(s(b),(t,l)=>(r(),p("div",{key:l,class:"q-mb-md"},[(r(),y(M(t.component),{label:t.label},null,8,["label"]))]))),128)),n("div",K,[n("div",X,[d(V,{label:"Update",type:"submit",color:"positive",icon:s(m).SAVE},null,8,["icon"])]),n("div",Z,[A(n("div",null,[d(U,{name:s(m).WARN,color:"warning"},null,8,["name"]),ee],512),[[N,!_.value]])])])]),_:1})]))]),_:1},8,["bannerIcon","bannerTitle"]))}});export{ce as default};
