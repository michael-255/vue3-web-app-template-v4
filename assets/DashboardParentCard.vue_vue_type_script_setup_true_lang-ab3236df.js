import{h as c,r as V,aO as W,E as G,aP as K,aQ as J,z as X,aR as Y,d as Z,a as ee,c as S,e as ae,w as u,f as s,Q as te,l as D,t as O,j,a4 as L,a6 as A,m as b,I as v,a7 as N,n as re,a2 as T,a1 as oe,aS as ne,aT as se,i as ie,b as P}from"./index-2ed2ead9.js";import{Q as F,a as g}from"./QItem-bf3f0c3d.js";import{Q as le}from"./QList-89957462.js";import{Q as de}from"./QMenu-d2947be1.js";import{Q as ue}from"./QBadge-ef537e40.js";import{u as fe}from"./useDialogs-bedc27ae.js";import{u as ce}from"./useRoutables-96f6398a.js";function k(e){return K()?(J(e),!0):!1}function R(e){return typeof e=="function"?e():c(e)}const Q=typeof window<"u";function me(e,a=1e3,r={}){const{immediate:o=!0,immediateCallback:l=!1}=r;let d=null;const f=V(!1);function m(){d&&(clearInterval(d),d=null)}function C(){f.value=!1,m()}function h(){const w=R(a);w<=0||(f.value=!0,l&&e(),m(),d=setInterval(e,w))}if(o&&Q&&h(),W(a)||typeof a=="function"){const w=G(a,()=>{f.value&&Q&&h()});k(w)}return k(C),{isActive:f,pause:C,resume:h}}const pe=Q?window:void 0;function ve(e,a={}){const{immediate:r=!0,window:o=pe}=a,l=V(!1);let d=0,f=null;function m(w){if(!l.value||!o)return;const t=w-d;e({delta:t,timestamp:w}),d=w,f=o.requestAnimationFrame(m)}function C(){!l.value&&o&&(l.value=!0,f=o.requestAnimationFrame(m))}function h(){l.value=!1,f!=null&&o&&(o.cancelAnimationFrame(f),f=null)}return r&&C(),k(h),{isActive:Y(l),pause:h,resume:C}}var ye=Object.defineProperty,U=Object.getOwnPropertySymbols,he=Object.prototype.hasOwnProperty,we=Object.prototype.propertyIsEnumerable,B=(e,a,r)=>a in e?ye(e,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[a]=r,Ce=(e,a)=>{for(var r in a||(a={}))he.call(a,r)&&B(e,r,a[r]);if(U)for(var r of U(a))we.call(a,r)&&B(e,r,a[r]);return e};function be(e={}){const{controls:a=!1,interval:r="requestAnimationFrame"}=e,o=V(new Date),l=()=>o.value=new Date,d=r==="requestAnimationFrame"?ve(l,{immediate:!0}):me(l,r,{immediate:!0});return a?Ce({now:o},d):o}var $e=Object.defineProperty,I=Object.getOwnPropertySymbols,x=Object.prototype.hasOwnProperty,z=Object.prototype.propertyIsEnumerable,M=(e,a,r)=>a in e?$e(e,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[a]=r,ge=(e,a)=>{for(var r in a||(a={}))x.call(a,r)&&M(e,r,a[r]);if(I)for(var r of I(a))z.call(a,r)&&M(e,r,a[r]);return e},_e=(e,a)=>{var r={};for(var o in e)x.call(e,o)&&a.indexOf(o)<0&&(r[o]=e[o]);if(e!=null&&I)for(var o of I(e))a.indexOf(o)<0&&z.call(e,o)&&(r[o]=e[o]);return r};const De=[{max:6e4,value:1e3,name:"second"},{max:276e4,value:6e4,name:"minute"},{max:72e6,value:36e5,name:"hour"},{max:5184e5,value:864e5,name:"day"},{max:24192e5,value:6048e5,name:"week"},{max:28512e6,value:2592e6,name:"month"},{max:1/0,value:31536e6,name:"year"}],Ee={justNow:"just now",past:e=>e.match(/\d/)?`${e} ago`:e,future:e=>e.match(/\d/)?`in ${e}`:e,month:(e,a)=>e===1?a?"last month":"next month":`${e} month${e>1?"s":""}`,year:(e,a)=>e===1?a?"last year":"next year":`${e} year${e>1?"s":""}`,day:(e,a)=>e===1?a?"yesterday":"tomorrow":`${e} day${e>1?"s":""}`,week:(e,a)=>e===1?a?"last week":"next week":`${e} week${e>1?"s":""}`,hour:e=>`${e} hour${e>1?"s":""}`,minute:e=>`${e} minute${e>1?"s":""}`,second:e=>`${e} second${e>1?"s":""}`,invalid:""};function Oe(e){return e.toISOString().slice(0,10)}function Te(e,a={}){const{controls:r=!1,updateInterval:o=3e4}=a,l=be({interval:o,controls:!0}),{now:d}=l,f=_e(l,["now"]),m=X(()=>Fe(new Date(R(e)),a,R(d.value)));return r?ge({timeAgo:m},f):m}function Fe(e,a={},r=Date.now()){var o;const{max:l,messages:d=Ee,fullDateFormatter:f=Oe,units:m=De,showSecond:C=!1,rounding:h="round"}=a,w=typeof h=="number"?p=>+p.toFixed(h):Math[h],t=+r-+e,n=Math.abs(t);function i(p,y){return w(Math.abs(p)/y.value)}function $(p,y){const E=i(p,y),_=p>0,H=q(y.name,E,_);return q(_?"past":"future",H,_)}function q(p,y,E){const _=d[p];return typeof _=="function"?_(y,E):_.replace("{0}",y.toString())}if(n<6e4&&!C)return d.justNow;if(typeof l=="number"&&n>l)return f(new Date(e));if(typeof l=="string"){const p=(o=m.find(y=>y.name===l))==null?void 0:o.max;if(p&&n>p)return f(new Date(e))}for(const[p,y]of m.entries()){if(i(t,y)<=0&&m[p-1])return $(t,m[p-1]);if(n<y.max)return $(t,y)}return d.invalid}const Ie={class:"text-h6"},Se={key:0},Ae={class:"absolute-top-right q-ma-xs"},Ne={class:"q-mb-md"},Pe={class:"text-caption q-ml-xs"},ke={key:0},Re={class:"text-caption q-ml-xs"},Me=Z({__name:"DashboardParentCard",props:{showDescription:{type:Boolean},dashboardCard:{}},setup(e){const{log:a}=ee(),{goToInspect:r,goToEdit:o,goToCharts:l}=ce(),{confirmDialog:d,dismissDialog:f}=fe();async function m(t){f("Previous Note",t,v.NOTE,"info")}async function C(t,n,i){d("Favorite",`Do you want to favorite ${i}?`,v.FAVORITE_ON,"info",async()=>{try{await P.updateRecord(t,n,{favorited:!0}),a.info(`${i} favorited`,{type:t,id:n,name:i})}catch($){a.error("Favorite update failed",$)}})}async function h(t,n,i){d("Unfavorite",`Do you want to unfavorite ${i}?`,v.FAVORITE_OFF,"info",async()=>{try{await P.updateRecord(t,n,{favorited:!1}),a.info(`${i} unfavorited`,{type:t,id:n,name:i})}catch($){a.error("Unfavorite update failed",$)}})}async function w(t,n,i){d("Delete",`Permanently delete ${i}? This will also delete any underlying child records.`,v.DELETE,"negative",async()=>{try{await P.deleteRecord(t,n),a.info(`${i} and grouped records deleted`,{type:t,id:n,name:i})}catch($){a.error("Delete failed",$)}})}return(t,n)=>(S(),ae(ie,null,{default:u(()=>[s(te,null,{default:u(()=>[D("p",Ie,O(t.dashboardCard.name),1),t.showDescription?(S(),j("p",Se,O(t.dashboardCard.desc),1)):L("",!0),D("div",Ae,[A(s(b,{name:c(v).NOTE,color:"primary",size:"md",class:"cursor-pointer q-mr-xs",onClick:n[0]||(n[0]=i=>m(t.dashboardCard.previousNote||""))},null,8,["name"]),[[N,t.dashboardCard.previousNote]]),A(s(b,{name:c(v).FAVORITE_ON,color:"warning",size:"md",class:"cursor-pointer",onClick:n[1]||(n[1]=i=>h(t.dashboardCard.type,t.dashboardCard.id,t.dashboardCard.name))},null,8,["name"]),[[N,t.dashboardCard.favorited]]),A(s(b,{name:c(v).FAVORITE_OFF,color:"grey",size:"md",class:"cursor-pointer",onClick:n[2]||(n[2]=i=>C(t.dashboardCard.type,t.dashboardCard.id,t.dashboardCard.name))},null,8,["name"]),[[N,!t.dashboardCard.favorited]]),s(re,{round:"",flat:"",icon:c(v).MENU_VERTICAL},{default:u(()=>[s(de,{"auto-close":"",anchor:"top right","transition-show":"flip-right","transition-hide":"flip-left"},{default:u(()=>[s(le,null,{default:u(()=>[s(F,{clickable:"",onClick:n[3]||(n[3]=i=>c(l)(t.dashboardCard.type,t.dashboardCard.id))},{default:u(()=>[s(g,{avatar:""},{default:u(()=>[s(b,{color:"accent",name:c(v).CHARTS},null,8,["name"])]),_:1}),s(g,null,{default:u(()=>[T("Charts")]),_:1})]),_:1}),s(F,{clickable:"",onClick:n[4]||(n[4]=i=>c(r)(t.dashboardCard.type,t.dashboardCard.id))},{default:u(()=>[s(g,{avatar:""},{default:u(()=>[s(b,{color:"primary",name:c(v).INSPECT},null,8,["name"])]),_:1}),s(g,null,{default:u(()=>[T("Inspect")]),_:1})]),_:1}),s(F,{clickable:"",onClick:n[5]||(n[5]=i=>c(o)(t.dashboardCard.type,t.dashboardCard.id))},{default:u(()=>[s(g,{avatar:""},{default:u(()=>[s(b,{color:"warning",name:c(v).EDIT},null,8,["name"])]),_:1}),s(g,null,{default:u(()=>[T("Edit")]),_:1})]),_:1}),s(oe),s(F,{clickable:"",onClick:n[6]||(n[6]=i=>w(t.dashboardCard.type,t.dashboardCard.id,t.dashboardCard.name))},{default:u(()=>[s(g,{avatar:""},{default:u(()=>[s(b,{color:"negative",name:c(v).DELETE},null,8,["name"])]),_:1}),s(g,null,{default:u(()=>[T("Delete")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["icon"])]),D("div",Ne,[s(ue,{rounded:"",color:"secondary",class:"q-py-none"},{default:u(()=>[s(b,{name:c(v).PREVIOUS},null,8,["name"]),D("span",Pe,O(c(Te)(t.dashboardCard.previousTimestamp||"").value||"No previous records"),1)]),_:1}),t.dashboardCard.previousTimestamp?(S(),j("div",ke,[s(b,{name:c(v).CALENDAR_CHECK},null,8,["name"]),D("span",Re,O(c(ne)(t.dashboardCard.previousTimestamp)),1)])):L("",!0)]),D("div",null,[se(t.$slots,"default")])]),_:3})]),_:3}))}});export{Me as _};
