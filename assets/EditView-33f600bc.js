import{d as k,u as C,A as $,a as x,b as w,r as A,J as B,a8 as Q,D as E,o as F,c as r,e as D,w as l,h as t,j as c,f as s,Q as T,m as S,I as i,i as M,F as N,k as q,l as n,n as j,a6 as G,a7 as L,ab as O,a9 as d,ac as W}from"./index-bcd0c63a.js";import{Q as z}from"./QForm-8eee3399.js";import{_ as J}from"./ResponsivePage.vue_vue_type_script_setup_true_lang-7d23b4d4.js";import{_ as Y}from"./ParentInfoCard.vue_vue_type_script_setup_true_lang-a82fe29f.js";import{u as H}from"./useRoutables-8e2fcfd3.js";import{u as K}from"./action-7fb54c5b.js";import{u as X}from"./useDialogs-a5eb05fb.js";import"./SimpleDialog.vue_vue_type_script_setup_true_lang-682ca1b0.js";const Z={key:0},P=n("span",{class:"q-ml-md"},"Error rendering this record",-1),ee={key:1},ae={class:"row justify-start"},te={class:"col"},oe={class:"col"},se=n("span",{class:"text-caption q-ml-xs text-warning"}," Correct invalid entries and try again ",-1),fe=k({__name:"EditView",setup(re){var y,h;C({title:`${$} - Edit Record`});const{routeUid:_,routeType:g,routeGroup:v,goBack:R}=H(),{log:u}=x(),{confirmDialog:I}=X(),m=K(),p=(y=w.find(e=>e.type===g&&e.group===v))==null?void 0:y.labelSingular,b=(h=w.find(e=>e.type===g&&e.group===v))==null?void 0:h.fieldProps,f=A(!0);B(async()=>{try{if(await Q.isValid(_)){const e=await E.getRecord(_);e&&Object.keys(e).forEach(o=>{m.record[o]=e[o]})}}catch(e){u.error("Error loading edit view",e)}}),F(()=>{m.$reset()});async function U(){I("Update",`Update ${p} record?`,i.CREATE,"positive",async()=>{try{const e=O(!0,{},m.record);await E.update(e.uid,e),u.info("Successfully updated record",{uid:e[d.UID],groupId:e[d.GROUP_ID],type:e[d.TYPE],group:e[d.GROUP]}),R()}catch(e){u.error("Update failed",e)}})}return(e,o)=>(r(),D(J,{bannerIcon:t(i).EDIT,bannerTitle:`Edit ${t(p)}`},{default:l(()=>[!t(p)||!t(b)?(r(),c("div",Z,[s(M,{class:"q-mb-md"},{default:l(()=>[s(T,null,{default:l(()=>[s(S,{name:t(i).WARN,size:"md",color:"warning"},null,8,["name"]),P]),_:1})]),_:1})])):(r(),c("div",ee,[s(z,{onSubmit:U,onValidationError:o[0]||(o[0]=a=>f.value=!1),onValidationSuccess:o[1]||(o[1]=a=>f.value=!0)},{default:l(()=>[s(Y),(r(!0),c(N,null,q(t(b),(a,V)=>(r(),c("div",{key:V,class:"q-mb-md"},[(r(),D(W(a.component),{field:a.field,label:a.label,desc:a.desc,getDefault:a.getDefault,validator:a.validator,validationMessage:a.validationMessage},null,8,["field","label","desc","getDefault","validator","validationMessage"]))]))),128)),n("div",ae,[n("div",te,[s(j,{label:"Update",type:"submit",color:"positive",icon:t(i).SAVE},null,8,["icon"])]),n("div",oe,[G(n("div",null,[s(S,{name:t(i).WARN,color:"warning"},null,8,["name"]),se],512),[[L,!f.value]])])])]),_:1})]))]),_:1},8,["bannerIcon","bannerTitle"]))}});export{fe as default};
