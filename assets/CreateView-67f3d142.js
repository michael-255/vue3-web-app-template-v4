import{k as x,U as E,A as R,F as $,D as i,r as h,l as B,Y as D,m as t,n as c,w as g,x as r,G as l,M as I,L as V,p as f,I as a,z as y,H as S,J as F,t as C,Q as L,al as Q,am as T,an as q}from"./index-fedd1f23.js";import{Q as N}from"./QForm-415f61fd.js";import{_ as j}from"./ErrorStates.vue_vue_type_script_setup_true_lang-80b2ae62.js";import{_ as M}from"./ResponsivePage.vue_vue_type_script_setup_true_lang-82cdf085.js";import{u as U}from"./action-06507f24.js";import{u as z}from"./useDialogs-65f1b21d.js";import{u as G}from"./useRouting-10a92d3b.js";import"./QSelect-3c47dbb7.js";import"./QItem-a384fd65.js";import"./QItemLabel-ee07051d.js";import"./QMenu-3df4d98a.js";import"./selection-25ddb021.js";import"./ui-abc64164.js";const H={key:0,class:"row justify-center q-my-sm"},J={key:1,class:"row justify-center q-my-sm"},K={class:"row justify-center"},O=C("span",{class:"text-caption q-ml-xs text-warning"}," Correct invalid entries and try again ",-1),le=x({__name:"CreateView",setup(P){E({title:`${R} - Create Record`});const{routeTable:o,routeParentId:_,goBack:b}=G(),{log:d}=$(),{confirmDialog:w}=z(),e=U(),m=i.getLabel(o,"singular"),v=i.getFieldComponents(o),u=h(!0);B(async()=>{try{e.table=o,e.record=i.getDefaultActionRecord(o),_&&(e.record.parentId=_)}catch(n){d.error("Error loading create view",n)}}),D(()=>{e.$reset()});async function k(){w("Create",`Create ${m} record?`,a.CREATE,"positive",async()=>{try{e.record.id=Q(),e.record.activated=!1,await i.addRecord(o,T(!0,{},e.record)),d.info("Record created",{table:o,id:e.record.id}),b()}catch(n){d.error("Create failed",n)}})}return(n,s)=>(t(),c(M,{bannerIcon:r(a).CREATE,bannerTitle:`Create ${r(m)}`},{default:g(()=>[r(m)&&r(v).length>0?(t(),c(N,{key:0,onSubmit:k,onValidationError:s[0]||(s[0]=p=>u.value=!1),onValidationSuccess:s[1]||(s[1]=p=>u.value=!0)},{default:g(()=>[(t(!0),l(V,null,I(r(v),(p,A)=>(t(),l("div",{key:A,class:"q-mb-md"},[(t(),c(q(p)))]))),128)),r(e).record.activated?(t(),l("div",J,[f(y,{disable:"",label:"Active",color:"warning",icon:r(a).LOCK},null,8,["icon"])])):(t(),l("div",H,[f(y,{label:"Create",type:"submit",color:"positive",icon:r(a).SAVE},null,8,["icon"])])),S(C("div",K,[f(L,{name:r(a).WARN,color:"warning"},null,8,["name"]),O],512),[[F,!u.value]])]),_:1})):(t(),c(j,{key:1,error:"unknown"}))]),_:1},8,["bannerIcon","bannerTitle"]))}});export{le as default};
