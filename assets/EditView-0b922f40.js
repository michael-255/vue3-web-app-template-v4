import{q as B,N as C,G as I,t as R,O as b,r as k,ab as q,a0 as g,ap as Q,D as E,x as $,y as o,z as w,A as l,u as t,S as u,B as r,C as A,Q as h,I as i,L as N,U as T,T as F,E as c,J as U,Y as L,Z as j,aq as z,ar as G}from"./index-408197b4.js";import{Q as M}from"./QForm-c7e690cc.js";import{_ as O}from"./ResponsivePage.vue_vue_type_script_setup_true_lang-729e840e.js";import{u as W}from"./useRoutables-132fa327.js";import{u as J}from"./action-4701911f.js";import{u as Y}from"./useDialogs-fad27234.js";import"./QSelect-436eab52.js";import"./QItem-404b2f94.js";import"./QItemLabel-3e7d15e3.js";import"./QMenu-c4003d51.js";import"./selection-cd46e154.js";import"./ui-65b145aa.js";const Z={key:0},H=c("span",{class:"q-ml-md"},"Error rendering this record",-1),K={key:1},P={class:"row justify-center q-my-sm"},X={class:"row justify-center"},ee=c("span",{class:"text-caption q-ml-xs text-warning"}," Correct invalid entries and try again ",-1),fe=B({__name:"EditView",setup(te){C({title:`${I} - Edit Record`});const{routeGroup:d,routeType:s,routeId:m,goBack:S}=W(),{log:p}=R(),{confirmDialog:V}=Y(),n=J(),f=b.getLabel(d,s,"singular"),v=b.getFields(d,s),_=k(!0);q(async()=>{try{if(n.record[g.Values.id]=Q(),n.record[g.Values.type]=s,m){const e=await E.getRecord(d,m);e&&Object.keys(e).forEach(a=>{n.record[a]=e[a]})}}catch(e){p.error("Error loading edit view",e)}}),$(()=>{n.$reset()});async function D(){V("Update",`Update ${f} record?`,i.EDIT,"positive",async()=>{try{const e=z(!0,{},n.record);await E.updateRecord(d,s,m,e),p.info("Successfully updated record",{id:e[g.Values.id],type:s}),S()}catch(e){p.error("Edit failed",e)}})}return(e,a)=>(o(),w(O,{bannerIcon:t(i).EDIT,bannerTitle:`Edit ${t(f)}`},{default:l(()=>[!t(f)||!t(v)?(o(),u("div",Z,[r(N,{class:"q-mb-md"},{default:l(()=>[r(A,null,{default:l(()=>[r(h,{name:t(i).WARN,size:"md",color:"warning"},null,8,["name"]),H]),_:1})]),_:1})])):(o(),u("div",K,[r(M,{onSubmit:D,onValidationError:a[0]||(a[0]=y=>_.value=!1),onValidationSuccess:a[1]||(a[1]=y=>_.value=!0)},{default:l(()=>[(o(!0),u(T,null,F(t(v),(y,x)=>(o(),u("div",{key:x,class:"q-mb-md"},[(o(),w(G(y),{inspecting:!1}))]))),128)),c("div",P,[r(U,{label:"Update",type:"submit",color:"positive",icon:t(i).SAVE},null,8,["icon"])]),c("div",X,[L(c("div",null,[r(h,{name:t(i).WARN,color:"warning"},null,8,["name"]),ee],512),[[j,!_.value]])])]),_:1})]))]),_:1},8,["bannerIcon","bannerTitle"]))}});export{fe as default};
