import{Q as k,a as _,b as x,c as U}from"./QTable-c26a2a32.js";import{k as F,U as M,A as j,l as H,r as m,D as p,m as G,n as c,p as f,w as a,q as s,G as E,M as S,L as V,K as g,y as o,V as q,B as u,I as i,O as J,v as b,x as h,Q,_ as K,N as X,H as z,J as W}from"./index-b1310b53.js";import{Q as Y}from"./QSelect-d09ef7ef.js";import{u as Z}from"./useRouting-7df5cfde.js";import{u as ee}from"./useDialogs-2a28f744.js";import"./QList-1577be23.js";import"./QItem-10c60c82.js";import"./QItemLabel-d1472da3.js";import"./QMenu-6d0c942a.js";import"./selection-f70df0eb.js";import"./action-9e6d41df.js";import"./ErrorStates.vue_vue_type_script_setup_true_lang-a4b91786.js";import"./ui-34ff337f.js";const oe={class:"row justify-start full-width q-mb-md"},le={class:"col-10 text-h6 text-bold ellipsis"},te={class:"row justify-start full-width"},ae={class:"col-12"},ye=F({__name:"DataRecordsView",setup(se){M({title:`${j} - Records Data Table`});const{log:v}=H(),{routeTable:r,goToEdit:B,goToCreate:I,goBack:L}=Z(),{confirmDialog:N,inspectDialog:R,chartsDialog:$}=ee(),y=m(""),d=m([]),w=m(p.getTableColumns(r)),T=m(w.value.filter(l=>!l.required)),C=m(T.value.map(l=>l.name)),D=p.liveDataTable(r).subscribe({next:l=>d.value=l,error:l=>v.error("Error fetching live records data",l)});G(()=>{D==null||D.unsubscribe()});async function A(l,t){N("Delete","Permanently delete this record? Please note that all child records are deleted when you delete a parent record.",i.DELETE,"negative",async()=>{try{await p.deleteRecord(l,t),v.info("Successfully deleted record",{table:l,id:t})}catch(e){v.error("Delete failed",e)}})}async function O(l,t){const e=await p.getRecord(l,t);e?R(e,l):v.error("Failed to find record",{table:l,id:t})}async function P(l,t){$(t,l)}return(l,t)=>(c(),f(U,{rows:d.value,columns:w.value,"visible-columns":C.value,"rows-per-page-options":[0],filter:y.value,"virtual-scroll":"",fullscreen:"","row-key":"id"},{header:a(e=>[s(_,{props:e},{default:a(()=>[(c(!0),E(V,null,S(e.cols,n=>z((c(),f(k,{key:n.name,props:e},{default:a(()=>[g(h(n.label),1)]),_:2},1032,["props"])),[[W,n.name!=="hiddenId"]])),128)),s(k,{"auto-width":"",class:"text-left"},{default:a(()=>[g("Actions")]),_:1})]),_:2},1032,["props"])]),body:a(e=>[s(_,{props:e},{default:a(()=>[(c(!0),E(V,null,S(e.cols,n=>(c(),f(x,{key:n.name,props:e},{default:a(()=>[g(h(n.value),1)]),_:2},1032,["props"]))),128)),s(x,{"auto-width":""},{default:a(()=>[[o(q).EXAMPLES,o(q).TESTS].includes(o(r))?(c(),f(u,{key:0,flat:"",round:"",dense:"",class:"q-ml-xs",color:"accent",icon:o(i).CHARTS,onClick:n=>P(o(r),e.cols[0].value)},null,8,["icon","onClick"])):J("",!0),s(u,{flat:"",round:"",dense:"",class:"q-ml-xs",color:"primary",icon:o(i).INSPECT,onClick:n=>O(o(r),e.cols[0].value)},null,8,["icon","onClick"]),s(u,{flat:"",round:"",dense:"",class:"q-ml-xs",color:"orange-9",icon:o(i).EDIT,onClick:n=>o(B)(o(r),e.cols[0].value)},null,8,["icon","onClick"]),s(u,{flat:"",round:"",dense:"",class:"q-ml-xs",color:"negative",onClick:n=>A(o(r),e.cols[0].value),icon:o(i).DELETE},null,8,["onClick","icon"])]),_:2},1024)]),_:2},1032,["props"])]),top:a(()=>[b("div",oe,[b("div",le,h(o(p).getLabel(o(r),"plural")),1),s(u,{round:"",flat:"",class:"absolute-top-right q-mr-sm q-mt-sm",icon:o(i).CLOSE,onClick:t[0]||(t[0]=e=>o(L)())},null,8,["icon"])]),b("div",te,[b("div",ae,[s(K,{disable:!d.value.length,outlined:"",dense:"",clearable:"",debounce:"300",modelValue:y.value,"onUpdate:modelValue":t[3]||(t[3]=e=>y.value=e),placeholder:"Search"},{before:a(()=>[s(u,{color:"positive",class:"q-px-sm q-mr-xs",icon:o(i).ADD,onClick:t[1]||(t[1]=e=>o(I)(o(r)))},null,8,["icon"]),s(Y,{modelValue:C.value,"onUpdate:modelValue":t[2]||(t[2]=e=>C.value=e),options:T.value,disable:!d.value.length,"bg-color":"primary",standout:"",multiple:"",dense:"","options-dense":"","emit-value":"","map-options":"","option-value":"name","display-value":""},{prepend:a(()=>[s(Q,{color:"white",name:o(i).OPTIONS},null,8,["name"])]),_:1},8,["modelValue","options","disable"])]),append:a(()=>[s(Q,{name:"search"})]),_:1},8,["disable","modelValue"])])])]),bottom:a(()=>[g(h(o(X)(d.value)),1)]),_:1},8,["rows","columns","visible-columns","filter"]))}});export{ye as default};
