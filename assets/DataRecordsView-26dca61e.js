import{Q as x,a as E,b as S,c as M}from"./QTable-d9aa79bb.js";import{q as z,N as H,G as J,t as W,r as g,O as c,W as _,a0 as b,D as C,x as X,y as m,z as y,A as n,B as r,S as q,T as Q,U as $,_ as w,u as l,J as p,I as u,X as Y,E as D,F as V,Q as L,a1 as Z,V as K,Y as ee,Z as le,a4 as ae}from"./index-ef11a4d2.js";import{Q as oe}from"./QSelect-f9ed5694.js";import{u as se}from"./useRoutables-81d4533e.js";import{u as te}from"./useDialogs-c3fdb6eb.js";import"./QList-5ee84f12.js";import"./QItem-bdaee51e.js";import"./QItemLabel-6937233e.js";import"./QMenu-17d8d43f.js";import"./selection-0dee77d8.js";import"./ui-29eb266c.js";const ne={class:"row justify-start full-width q-mb-md"},re={class:"col-10 text-h6 text-bold ellipsis"},ie={class:"row justify-start full-width"},ue={class:"col-12"},De=z({__name:"DataRecordsView",setup(ce){H({title:`${J} - Records Data`});const{log:h}=W(),{routeGroup:t,routeType:i,goToEdit:N,goToCreate:R,goBack:B}=se(),{confirmDialog:I,inspectDialog:P,chartsDialog:A}=te(),k=g(""),d=g([]),v=g([]),T=g(c.getTableColumns(t,i)),F=g(T.value.filter(a=>!a.required));let f=null;t===_.Values.core?(v.value=[b.Values.id,b.Values.timestamp,b.Values.name],f=C.liveCoreRecords(i).subscribe({next:a=>{d.value=a},error:a=>{h.error("Error fetching live parent data",a)}})):(v.value=[b.Values.id,b.Values.timestamp],f=C.liveSubRecords(i).subscribe({next:a=>{d.value=a},error:a=>{h.error("Error fetching live child data",a)}})),X(()=>{f==null||f.unsubscribe()});async function O(a,o){let e="";a===_.Values.core?e=`Permanently delete ${c.getLabel(t,i,"singular")} with id ${o}? This will also delete associated sub-records.`:e=`Permanently delete ${c.getLabel(t,i,"singular")} with id ${o}?`,I("Delete",e,u.DELETE,"negative",async()=>{try{await C.deleteRecord(a,o),h.info("Successfully deleted record",{type:i,id:o})}catch(s){h.error("Delete failed",s)}})}async function U(a,o){const e=c.getLabel(t,a,"singular"),s=c.getFieldProps(t,a),j=await C.getRecord(t,o);P(e,s,j)}async function G(a,o){const e=c.getLabel(t,i,"singular");A(e,a,o)}return(a,o)=>(m(),y(M,{rows:d.value,columns:T.value,"visible-columns":v.value,"rows-per-page-options":[0],filter:k.value,"virtual-scroll":"",fullscreen:"","row-key":"id"},{header:n(e=>[r(E,{props:e},{default:n(()=>[(m(!0),q($,null,Q(e.cols,s=>ee((m(),y(x,{key:s.name,props:e},{default:n(()=>[w(V(s.label),1)]),_:2},1032,["props"])),[[le,!l(ae).includes(s.name)]])),128)),r(x,{"auto-width":"",class:"text-left"},{default:n(()=>[w("Actions")]),_:1})]),_:2},1032,["props"])]),body:n(e=>[r(E,{props:e},{default:n(()=>[(m(!0),q($,null,Q(e.cols,s=>(m(),y(S,{key:s.name,props:e},{default:n(()=>[w(V(s.value),1)]),_:2},1032,["props"]))),128)),r(S,{"auto-width":""},{default:n(()=>[l(t)===l(_).Values.core?(m(),y(p,{key:0,flat:"",round:"",dense:"",class:"q-ml-xs",color:"accent",icon:l(u).CHARTS,onClick:s=>G(l(i),e.cols[0].value)},null,8,["icon","onClick"])):Y("",!0),r(p,{flat:"",round:"",dense:"",class:"q-ml-xs",color:"primary",icon:l(u).INSPECT,onClick:s=>U(l(i),e.cols[0].value)},null,8,["icon","onClick"]),r(p,{flat:"",round:"",dense:"",class:"q-ml-xs",color:"orange-9",icon:l(u).EDIT,onClick:s=>l(N)(l(t),l(i),e.cols[0].value)},null,8,["icon","onClick"]),r(p,{flat:"",round:"",dense:"",class:"q-ml-xs",color:"negative",onClick:s=>O(l(t),e.cols[0].value),icon:l(u).DELETE},null,8,["onClick","icon"])]),_:2},1024)]),_:2},1032,["props"])]),top:n(()=>[D("div",ne,[D("div",re,V(l(c).getLabel(l(t),l(i),"plural")),1),r(p,{round:"",flat:"",class:"absolute-top-right q-mr-sm q-mt-sm",icon:l(u).CLOSE,onClick:o[0]||(o[0]=e=>l(B)())},null,8,["icon"])]),D("div",ie,[D("div",ue,[r(Z,{disable:!d.value.length,outlined:"",dense:"",clearable:"",debounce:"300",modelValue:k.value,"onUpdate:modelValue":o[3]||(o[3]=e=>k.value=e),placeholder:"Search"},{before:n(()=>[r(p,{color:"positive",class:"q-px-sm q-mr-xs",icon:l(u).ADD,onClick:o[1]||(o[1]=e=>l(R)(l(t),l(i)))},null,8,["icon"]),r(oe,{modelValue:v.value,"onUpdate:modelValue":o[2]||(o[2]=e=>v.value=e),options:F.value,disable:!d.value.length,"bg-color":"primary",standout:"",multiple:"",dense:"","options-dense":"","emit-value":"","map-options":"","option-value":"name","display-value":""},{prepend:n(()=>[r(L,{color:"white",name:l(u).OPTIONS},null,8,["name"])]),_:1},8,["modelValue","options","disable"])]),append:n(()=>[r(L,{name:"search"})]),_:1},8,["disable","modelValue"])])])]),bottom:n(()=>[w(V(l(K)(d.value)),1)]),_:1},8,["rows","columns","visible-columns","filter"]))}});export{De as default};
