import{d as R,u as T,A as D,a as k,O as A,r as I,G as w,c as o,o as F,f as a,h as b,w as d,l as r,q as u,j as i,Q as S,m as x,F as B,s as $,p as s,B as Q,I as m,n as V,v as N,t as P,z as q,H as M,P as L,D as Y,R as j}from"./index-85cdcb14.js";import{Q as z}from"./QForm-0062d92d.js";import{_ as G}from"./ResponsivePage.vue_vue_type_script_setup_true_lang-41aa508e.js";import{u as H}from"./useRoutables-c00f81b4.js";import{u as O}from"./action-c39eed1c.js";import{u as U}from"./useDialogs-bd0c25a5.js";import"./SimpleDialog.vue_vue_type_script_setup_true_lang-7796c2c3.js";const W={key:0},J=s("div",{class:"text-h6"},"No fields available for this record type",-1),K={key:1},X={class:"row justify-start"},Z={class:"col"},ee={class:"col"},te=s("span",{class:"text-caption q-ml-xs text-warning"}," Correct invalid entries and try again ",-1),de=R({__name:"ActionCreateView",setup(oe){T({title:`${D} - Create Record`});const{routeDatabaseType:c,routeParentId:g,goBack:y}=H(),{log:f}=k(),{confirmDialog:C}=U(),p=O(),v=A(c),_=I(!0);w(()=>{try{p.record[o.TYPE]=c}catch(n){f.error("Error loading create view",n)}}),F(()=>{p.$reset()});async function E(){const e=M(c).reduce((t,l)=>(t[l]=p.record[l],t),{});C("Create Record",`Create record ${e[o.ID]} for ${e[o.TYPE]}?`,m.CREATE,"positive",async()=>{try{const t=L(!0,{},e);await Y.addRecord(t),f.info("Successfully created record",{createdRecordType:e[o.TYPE],createdRecordId:e[o.ID]}),y()}catch(t){f.error("Create failed",t)}})}function h(n){const e=[o.PARENT_ID,o.CREATED_TIMESTAMP];return!!(g&&e.includes(n))}return(n,e)=>(a(),b(G,{bannerIcon:r(m).CREATE,bannerTitle:`Create ${r(q)(r(c),"singular")}`},{default:d(()=>[r(v).length===0?(a(),u("div",W,[i(x,{class:"q-mb-md"},{default:d(()=>[i(S,null,{default:d(()=>[J]),_:1})]),_:1})])):(a(),u("div",K,[i(z,{greedy:"",onSubmit:E,onValidationError:e[0]||(e[0]=t=>_.value=!1),onValidationSuccess:e[1]||(e[1]=t=>_.value=!0)},{default:d(()=>[(a(!0),u(B,null,$(r(v),(t,l)=>(a(),u("div",{key:l,class:"q-mb-md"},[(a(),b(j(t.component),{locked:h(t.field),label:t.label},null,8,["locked","label"]))]))),128)),s("div",X,[s("div",Z,[i(Q,{label:"Create",type:"submit",color:"positive",icon:r(m).SAVE},null,8,["icon"])]),s("div",ee,[V(s("div",null,[i(P,{name:r(m).WARN,color:"warning"},null,8,["name"]),te],512),[[N,!_.value]])])])]),_:1})]))]),_:1},8,["bannerIcon","bannerTitle"]))}});export{de as default};
